<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>订单管理</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .order-item { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
        .dish-list { margin-left: 20px; }
        #sales-stats { margin-top: 20px; }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
    <a href="index.html">返回主页</a>
    <h1>订单管理</h1>
    <div id="order-list">
        <!-- 订单列表将在这里动态生成 -->
    </div>
    <div id="sales-stats">
        <h2>销售统计</h2>
        <!-- 销售统计将在这里动态生成 -->
    </div>

    <script>
        function loadOrders() {
            const orderList = document.getElementById('order-list');
            const orders = JSON.parse(localStorage.getItem('orders')) || [];

            if (orders.length === 0) {
                orderList.innerHTML = '<p>暂无订单</p>';
                return;
            }

            orderList.innerHTML = '';
            orders.forEach((order, index) => {
                let orderHtml = `
                    <div class="order-item" id="order-${order.id}">
                        <h3>订单 #${order.id}</h3>
                        <p>总价: ¥${order.total.toFixed(2)}</p>
                        <h4>点餐详情:</h4>
                        <ul class="dish-list">
                `;

                order.items.forEach(item => {
                    orderHtml += `<li>${item.name} - ¥${item.price}</li>`;
                });

                orderHtml += `
                        </ul>
                        <button onclick="printOrder(${order.id})">打印小票</button>
                    </div>
                `;

                orderList.innerHTML += orderHtml;
            });
        }

        function loadSalesStats() {
            const statsDiv = document.getElementById('sales-stats');
            const stats = JSON.parse(localStorage.getItem('salesStats')) || {};

            let statsHtml = '<h2>销售统计</h2><ul>';
            for (let dish in stats) {
                statsHtml += `<li>${dish}: 售出 ${stats[dish]} 份</li>`;
            }
            statsHtml += '</ul>';

            statsDiv.innerHTML = statsHtml;
        }

        function printOrder(orderId) {
            const orderElement = document.getElementById(`order-${orderId}`);
            html2canvas(orderElement).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const newWindow = window.open('');
                newWindow.document.write('<img src="' + imgData + '" />');
                newWindow.document.close();
                setTimeout(() => {
                    newWindow.print();
                    newWindow.close();
                }, 500);
            });
        }

        // 页面加载时显示订单和销售统计
        loadOrders();
        loadSalesStats();
    </script>
</body>
</html>